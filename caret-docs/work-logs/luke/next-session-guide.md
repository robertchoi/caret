# 다음 세션 가이드 (2025-07-03 업데이트)

## 🎉 현재 작업 필요 상태

### 다음 세션 주요 작업
- **Task #016:** 페르소나 초기화 및 이미지 문제 해결
  - **진행 상황**: 페르소나 초기화 기능 구현 완료, 이미지 업데이트 로직 일원화 진행 중
  - **설계 결정사항**:
    - `PersonaInitializer` 클래스를 구현하여 페르소나 초기화 로직 분리
    - `CaretProvider`에 싱글톤 패턴과 `notifyPersonaImagesChanged` 메서드 추가하여 이미지 업데이트 로직 일원화
    - 웹뷰 내 이미지 업데이트 메시지 타입을 `RESPONSE_PERSONA_IMAGES`로 통일
  - **식별된 문제**:
    - 페르소나 이미지 업데이트는 정상 작동하나, 채팅창 및 NewTask 페이지에서 이미지가 제대로 표시되지 않음
    - 사용자 이미지 업로드 시 이전 이미지가 나오는 시점 문제 존재
    - 페르소나 매니저와 채팅 row의 이미지 업데이트 로직 차이 확인 필요
  - **남은 작업**:
    - NewTask 페이지에 페르소나 이미지 표시 로직 구현
    - ChatRow 컴포넌트의 이미지 업데이트 로직 개선
    - 통합 테스트 및 검증

- **Task #005:** Caret 웹뷰 UI 다국어 지원 구현 진행 중
  - **진행 상황**: 백엔드 응답 구조화 완료, 웹뷰 UI 다국어 지원 일부 누락
  - **설계 결정사항**:
    - AI 응답 메시지는 시스템 메시지 성격으로 다국어 지원 불필요 → **백엔드 i18n 시스템 삭제**
    - 대신 CaretResponses 클래스를 통한 JSON 기반 응답 관리 구현 완료
    - 웹뷰 UI 다국어 지원에만 집중하기로 결정
  - **남은 작업**:
    - 메인 페이지 및 채팅창 UI 다국어 지원 (자동 승인 설정, Task/Tokens 영역 등)
    - 웰컴뷰 풋터 번역 완성
    - 전체 UI 다국어 지원 검증
  - **🚨 긴급: 시스템 프롬프트 누락 버그 발견**:
    - **원인**: `caret-src/core/prompts/JsonTemplateLoader.ts`의 `adaptLegacyFormat` 함수가 `BASE_PROMPT_INTRO.json`과 같이 최상위 필드가 객체 형태인 특정 구조의 JSON 템플릿을 올바르게 파싱하지 못하는 버그 발견.
    - **영향**: 이 버그로 인해 해당 JSON 템플릿의 내용이 시스템 프롬프트에 포함되지 않고 **누락**되어, 현재 Caret 서비스의 AI가 **불완전한 시스템 프롬프트를 받고 있는 상태**임. 이는 Caret의 핵심 기능인 동적 프롬프트 시스템이 의도대로 동작하지 않고 있음을 의미.
  - **다음 단계**:
    - **1순위**: `JsonTemplateLoader.ts`의 `adaptLegacyFormat` 함수를 수정하여 시스템 프롬프트 누락 버그를 해결.
    - **2순위**: Task #005의 나머지 작업(UI 번역 등)을 계속 진행.

### 기타 식별된 태스크 (별도 문서로 분리됨)
- **Task #014:** AI 파일 읽기 불일치 버그
- **Task #015:** 웹뷰 UI 개선 (웰컴뷰 및 메인 페이지)
- **Task #017:** 작업 공간 규칙 초기화 문제 해결
- **Task #019:** 캐럿티브 홈페이지 개발
