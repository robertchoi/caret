# Caret í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## 1. ê°œìš”

ì´ ë¬¸ì„œëŠ” Caret í”„ë¡œì íŠ¸ì˜ í…ŒìŠ¤íŠ¸ ì „ëµ, ì‘ì„± ë°©ë²•, ì‹¤í–‰ ë°©ë²•ì— ëŒ€í•œ ì¢…í•© ê°€ì´ë“œì…ë‹ˆë‹¤. Caretì€ **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 100%**ë¥¼ ëª©í‘œë¡œ í•˜ë©°, **í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ(TDD)** ë°©ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

## 1.1 ë¹ ë¥¸ ì‹œì‘ - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´

### ğŸ“Š ì „ì²´ í…ŒìŠ¤íŠ¸ + ì»¤ë²„ë¦¬ì§€ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ğŸŒŸ ê°€ì¥ ì¶”ì²œ: ì „ì²´ í…ŒìŠ¤íŠ¸ + ì»¤ë²„ë¦¬ì§€ ë¶„ì„ í•œë²ˆì—
npm run test:all; npm run caret:coverage

# ë˜ëŠ” ë°±ì—”ë“œ ìƒì„¸ ì»¤ë²„ë¦¬ì§€ê¹Œì§€ í¬í•¨
npm run test:all; npm run test:backend:coverage; npm run caret:coverage
```

### ğŸ¯ ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ (React ì»´í¬ë„ŒíŠ¸, UI ë¡œì§)
npm run test:webview

# ë°±ì—”ë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ê°œë³„ ëª¨ë“ˆ, í•¨ìˆ˜)
npm run test:backend

# ë°±ì—”ë“œ ê°ì‹œ ëª¨ë“œ (ê°œë°œ ì¤‘ ìë™ ì‹¤í–‰)
npm run test:backend:watch

# í†µí•© í…ŒìŠ¤íŠ¸ (VSCode Extension í™˜ê²½)
npm run test:integration
```

### ğŸ“ˆ ì»¤ë²„ë¦¬ì§€ ë¶„ì„

```bash
# Caret ì „ìš© ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¶„ì„ (íŒŒì¼ë³„ ìƒì„¸)
npm run caret:coverage

# ë°±ì—”ë“œ Vitest ì»¤ë²„ë¦¬ì§€ (ë¼ì¸ë³„ ìƒì„¸)
npm run test:backend:coverage

# VSCode Extension í†µí•© ì»¤ë²„ë¦¬ì§€
npm run test:coverage
```

## 2. í…ŒìŠ¤íŠ¸ ì „ëµ

### 2.1 í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

**Caret ì „ìš© ì½”ë“œ 100% ì»¤ë²„ë¦¬ì§€ ì›ì¹™:**

-   **ğŸ¥• Caret ì‹ ê·œ ë¡œì§**: `caret-src/`, `webview-ui/src/caret/` ë””ë ‰í† ë¦¬ì˜ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ê¸°ëŠ¥ ì½”ë“œ**ëŠ” **100% í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í•„ìˆ˜**
-   **ğŸ”— Re-export íŒŒì¼**: Cline ëª¨ë“ˆì˜ ë‹¨ìˆœ ì¬ë‚´ë³´ë‚´ê¸° íŒŒì¼ (ì˜ˆ: `export { ... } from "..."`)ì€ í…ŒìŠ¤íŠ¸ ì œì™¸ ê°€ëŠ¥
-   **ğŸ“¦ Type ì •ì˜**: ëŸ°íƒ€ì„ ë¡œì§ì´ ì—†ëŠ” ì¸í„°í˜ì´ìŠ¤/íƒ€ì… ì •ì˜ë§Œ í¬í•¨í•œ íŒŒì¼ì€ í…ŒìŠ¤íŠ¸ ì œì™¸ ê°€ëŠ¥
-   **ğŸ¤– Cline ì›ë³¸ ì½”ë“œ**: `src/`, `webview-ui/src/` (caret í´ë” ì œì™¸)ëŠ” Clineì˜ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ë¥¼ í™œìš©í•˜ë©°, ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì‘ì„±ì„ ê°•ì œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
-   **ğŸ“Š ì»¤ë²„ë¦¬ì§€ ë¶„ì„**: `caret-scripts/caret-coverage-check.js`ë¥¼ ì‚¬ìš©í•˜ì—¬ Caret vs Cline ì½”ë“œì˜ ì»¤ë²„ë¦¬ì§€ë¥¼ ë¶„ë¦¬ ë¶„ì„í•©ë‹ˆë‹¤.

#### í˜„ì¬ í…ŒìŠ¤íŠ¸ ì œì™¸ íŒŒì¼ë“¤ (ì •ë‹¹í•œ ì´ìœ )

-   `caret-src/core/prompts/system.ts` - Cline ëª¨ë“ˆ ì¬ë‚´ë³´ë‚´ê¸°
-   `caret-src/shared/providers/types.ts` - TypeScript ì¸í„°í˜ì´ìŠ¤ ì •ì˜ë§Œ í¬í•¨
-   `caret-src/core/task/index.ts` - ì¼ë¶€ ë˜í¼ ë¡œì§ (í–¥í›„ í…ŒìŠ¤íŠ¸ ì¶”ê°€ ì˜ˆì •)

### 2.2 í…ŒìŠ¤íŠ¸ ìœ í˜•

#### 2.2.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Tests)

-   **ëŒ€ìƒ**: ê°œë³„ í•¨ìˆ˜, í´ë˜ìŠ¤, ì»´í¬ë„ŒíŠ¸
-   **ë„êµ¬**: Vitest (ë°±ì—”ë“œ/í”„ë¡ íŠ¸ì—”ë“œ í†µì¼)
-   **ìœ„ì¹˜**: `__tests__/` í´ë” ë˜ëŠ” `.test.ts/.test.tsx` íŒŒì¼

#### 2.2.2 í†µí•© í…ŒìŠ¤íŠ¸ (Integration Tests)

-   **ëŒ€ìƒ**: ì—¬ëŸ¬ ëª¨ë“ˆ ê°„ì˜ ìƒí˜¸ì‘ìš©, ì‹¤ì œ ë¹Œë“œ ê²€ì¦, ì‹œìŠ¤í…œ ì „ì²´ ë™ì‘
-   **ë„êµ¬**: Vitest (ë°±ì—”ë“œ), VSCode Extension Test Runner, React Testing Library
-   **ìœ„ì¹˜**: `caret-src/__tests__/integration.test.ts`, `src/test/`, `webview-ui/src/__tests__/`
-   **íŠ¹ì§•**: ì‹¤ì œ ëª…ë ¹ì–´ ì‹¤í–‰ì„ í†µí•œ ë¹Œë“œ/ì»´íŒŒì¼ ê²€ì¦ (2025-01-21 ì—…ë°ì´íŠ¸)
-   **ìƒˆë¡œìš´ ì ‘ê·¼**: ëª¨í‚¹ëœ í™˜ê²½ì´ ì•„ë‹Œ ì‹¤ì œ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ ê²€ì¦ìœ¼ë¡œ ë³€ê²½

#### 2.2.3 E2E í…ŒìŠ¤íŠ¸ (End-to-End Tests)

-   **ëŒ€ìƒ**: ì „ì²´ ì›Œí¬í”Œë¡œìš°
-   **ë„êµ¬**: VSCode Extension Development Host
-   **ë°©ë²•**: F5 ë””ë²„ê¹…ì„ í†µí•œ ìˆ˜ë™/ìë™ í…ŒìŠ¤íŠ¸

### 2.3 TDD(Test-Driven Development) ë°©ì‹ âš¡ **í•„ìˆ˜**

Caretì€ **TDD ë°©ì‹ì„ í•„ìˆ˜**ë¡œ í•©ë‹ˆë‹¤:

1. **Red**: ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±
2. **Green**: í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ëŠ” ìµœì†Œí•œì˜ ì½”ë“œ ì‘ì„±
3. **Refactor**: ì½”ë“œ í’ˆì§ˆ ê°œì„  (í…ŒìŠ¤íŠ¸ëŠ” ê³„ì† í†µê³¼)

**ğŸš¨ AI ê°œë°œì í•„ìˆ˜ ì›ì¹™**:

-   âŒ **êµ¬í˜„ ë¨¼ì € ê¸ˆì§€**: ì½”ë“œ ì‘ì„± ì „ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸ë¶€í„°
-   âœ… **í…ŒìŠ¤íŠ¸ ìš°ì„ **: "í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤" ì„ ì–¸ í•„ìˆ˜
-   âœ… **ë‹¨ê³„ë³„ ì§„í–‰**: RED â†’ GREEN â†’ REFACTOR ìˆœì„œ ì—„ìˆ˜

**ì‹¤ì œ ì ìš© ì˜ˆì‹œ (UI ì–¸ì–´ ì„¤ì •)**:

```typescript
// RED: ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±
it("should update only uiLanguage without affecting other settings", async () => {
	await setUILanguage("ja")
	expect(mockUpdateSettings).toHaveBeenCalledWith({
		uiLanguage: "ja", // ì˜¤ì§ ì´ê²ƒë§Œ
	})
	expect(state.chatSettings.model).toBe("claude-3") // ë‹¤ë¥¸ ì„¤ì • ì˜í–¥ ì—†ìŒ
})

// GREEN: ìµœì†Œ êµ¬í˜„
const setUILanguage = async (language: string) => {
	await StateServiceClient.updateSettings({ uiLanguage: language })
}

// REFACTOR: ì—ëŸ¬ ì²˜ë¦¬, ìƒíƒœ ì—…ë°ì´íŠ¸ ë“± ê°œì„ 
```

## 3. í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ë° ë„êµ¬

### 3.1 ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ (caret-src/)

#### 3.1.1 í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

```json
{
	"devDependencies": {
		"vitest": "^3.0.5",
		"@vitest/coverage-v8": "^3.0.9",
		"@types/node": "^22.13.4"
	}
}
```

#### 3.1.2 Vitest ì„¤ì • (vitest.config.ts)

```typescript
import { defineConfig } from "vitest/config"
import path from "path"

export default defineConfig({
	test: {
		environment: "node",
		globals: true,
		include: [
			"caret-src/**/*.test.ts",
			"!src/**/*", // Cline ì›ë³¸ í…ŒìŠ¤íŠ¸ ì œì™¸
		],
		coverage: {
			provider: "v8",
			include: ["caret-src/**/*.ts", "!caret-src/**/*.test.ts", "!caret-src/**/*.d.ts"],
			reportOnFailure: true,
			reporter: ["text", "json", "html"],
		},
		logHeapUsage: false,
		silent: false,
	},
	resolve: {
		alias: {
			"@": path.resolve(__dirname, "./caret-src"),
			"@shared": path.resolve(__dirname, "./src/shared"),
		},
	},
})
```

### 3.2 í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ (webview-ui/src/caret/)

#### 3.2.1 í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

```json
{
	"devDependencies": {
		"@testing-library/react": "^14.0.0",
		"@testing-library/jest-dom": "^6.0.0",
		"@testing-library/user-event": "^14.0.0",
		"vitest": "^1.0.0",
		"@vitejs/plugin-react": "^4.0.0"
	}
}
```

#### 3.2.2 Vitest ì„¤ì • (vitest.config.ts)

```typescript
import { defineConfig } from "vitest/config"
import react from "@vitejs/plugin-react"

export default defineConfig({
	plugins: [react()],
	test: {
		environment: "jsdom",
		setupFiles: ["./src/test-setup.ts"],
		include: ["src/caret/**/*.test.{ts,tsx}"],
		coverage: {
			include: ["src/caret/**/*.{ts,tsx}"],
			exclude: ["src/caret/**/*.test.{ts,tsx}", "src/caret/**/*.d.ts"],
			reporter: ["text", "lcov", "html"],
			reportsDirectory: "coverage/caret-frontend",
		},
	},
})
```

## 4. í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œ

### 4.1 íŒŒì¼ ëª…ëª… ê·œì¹™

#### 4.1.1 í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜

```
caret-src/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ webview/
â”‚   â”‚   â”œâ”€â”€ CaretProvider.ts
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ CaretProvider.test.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ caret-logger.ts
â”‚       â””â”€â”€ caret-logger.test.ts

webview-ui/src/caret/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ CaretWelcome.tsx
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ CaretWelcome.test.tsx
â””â”€â”€ utils/
    â”œâ”€â”€ i18n.ts
    â””â”€â”€ i18n.test.ts
```

#### 4.1.2 í…ŒìŠ¤íŠ¸ íŒŒì¼ ëª…ëª… ê·œì¹™

-   **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: `{ComponentName}.test.{ts|tsx}`
-   **í†µí•© í…ŒìŠ¤íŠ¸**: `{FeatureName}.integration.test.{ts|tsx}`
-   **í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬**: `__tests__/` (ì„ íƒì )

### 4.2 ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‘ì„±

#### 4.2.1 ê¸°ë³¸ í…ŒìŠ¤íŠ¸ êµ¬ì¡°

```typescript
// caret-src/utils/__tests__/caret-logger.test.ts
import { describe, it, expect, vi, beforeEach, afterEach } from "vitest"
import { CaretLogger, CaretLogLevel } from "../caret-logger"

describe("CaretLogger", () => {
	let logger: CaretLogger
	let mockOutputChannel: any

	beforeEach(() => {
		mockOutputChannel = {
			appendLine: vi.fn(),
		}
		logger = new CaretLogger(mockOutputChannel)
	})

	afterEach(() => {
		vi.clearAllMocks()
	})

	describe("constructor", () => {
		it("should create logger with output channel", () => {
			expect(logger).toBeDefined()
		})
	})

	describe("log methods", () => {
		it("should log info message", () => {
			const consoleSpy = vi.spyOn(console, "info")
			logger.info("test message", "TEST")

			expect(mockOutputChannel.appendLine).toHaveBeenCalled()
			expect(consoleSpy).toHaveBeenCalled()
		})

		it("should log error message", () => {
			const consoleSpy = vi.spyOn(console, "error")
			logger.error("error message", "ERROR")

			expect(mockOutputChannel.appendLine).toHaveBeenCalled()
			expect(consoleSpy).toHaveBeenCalled()
		})
	})
})
```

#### 4.2.2 VSCode API ëª¨í‚¹

```typescript
// caret-src/__tests__/setup.ts
import { vi } from "vitest"

// VSCode API ëª¨í‚¹ (Vitest)
vi.mock("vscode", () => ({
	window: {
		createOutputChannel: vi.fn(() => ({
			appendLine: vi.fn(),
			show: vi.fn(),
			dispose: vi.fn(),
		})),
		showErrorMessage: vi.fn(),
		showInformationMessage: vi.fn(),
	},
	ExtensionContext: vi.fn(),
	Uri: {
		file: vi.fn(),
		parse: vi.fn(),
	},
}))
```

### 4.3 í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‘ì„±

#### 4.3.1 React ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸

```typescript
// webview-ui/src/caret/components/__tests__/CaretWelcome.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { CaretWelcome } from '../CaretWelcome';

describe('CaretWelcome', () => {
  it('should render welcome message', () => {
    render(<CaretWelcome />);
    expect(screen.getByText(/Caretì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤/)).toBeInTheDocument();
  });

  it('should handle button click', async () => {
    const mockOnClick = vi.fn();
    render(<CaretWelcome onStartClick={mockOnClick} />);

    const startButton = screen.getByRole('button', { name: /ì‹œì‘í•˜ê¸°/ });
    fireEvent.click(startButton);

    expect(mockOnClick).toHaveBeenCalledTimes(1);
  });

  it('should display Korean text correctly', () => {
    render(<CaretWelcome />);
    expect(screen.getByText('ë°”ì´ë¸Œ ì½”ë”©')).toBeInTheDocument();
  });
});
```

#### 4.3.2 ì»¤ìŠ¤í…€ í›… í…ŒìŠ¤íŠ¸

```typescript
// webview-ui/src/caret/hooks/__tests__/useCaretState.test.ts
import { renderHook, act } from "@testing-library/react"
import { describe, it, expect } from "vitest"
import { useCaretState } from "../useCaretState"

describe("useCaretState", () => {
	it("should initialize with default state", () => {
		const { result } = renderHook(() => useCaretState())

		expect(result.current.isReady).toBe(false)
		expect(result.current.currentMode).toBe("welcome")
	})

	it("should update state correctly", () => {
		const { result } = renderHook(() => useCaretState())

		act(() => {
			result.current.setReady(true)
		})

		expect(result.current.isReady).toBe(true)
	})
})
```

### 4.4 í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

#### 4.4.1 ì‹œìŠ¤í…œ ë ˆë²¨ í†µí•© í…ŒìŠ¤íŠ¸ (ìƒˆë¡œìš´ ë°©ì‹)

```typescript
// caret-src/__tests__/integration.test.ts
import { describe, it, expect } from "vitest"
import { spawn } from "child_process"
import { promisify } from "util"

const execAsync = promisify(require("child_process").exec)

describe("Integration Tests", () => {
	it("should compile backend successfully", async () => {
		try {
			const { stdout, stderr } = await execAsync("npm run check-types")
			expect(stderr).toBe("")
			expect(stdout).toContain("tsc --noEmit")
		} catch (error: any) {
			throw new Error(`Backend compilation failed: ${error.message}`)
		}
	}, 30000)

	it("should build webview-ui successfully", async () => {
		try {
			const { stdout, stderr } = await execAsync("cd webview-ui && npm run build")
			expect(stdout).toContain("vite")
			expect(stdout).toContain("building for production")
			expect(stderr).not.toContain("Build failed")
			expect(stderr).not.toContain("error during build")
		} catch (error: any) {
			throw new Error(`Webview-UI build failed: ${error.message}`)
		}
	}, 60000)

	it("should have grpc-client files in ES6 module format", async () => {
		const fs = require("fs")
		const path = require("path")

		try {
			const grpcClientPath = path.join(process.cwd(), "webview-ui/src/services/grpc-client.js")
			const content = fs.readFileSync(grpcClientPath, "utf8")

			expect(content).toContain("import {")
			expect(content).toContain("export const")
			expect(content).not.toContain("require(")
			expect(content).not.toContain("exports.")
			expect(content).toContain("StateServiceClient")
		} catch (error: any) {
			throw new Error(`GRPC client format check failed: ${error.message}`)
		}
	})

	it("should have consistent rule priority logic", async () => {
		try {
			const { stdout } = await execAsync("npm run test:backend -- rule-priority")
			expect(stdout).toContain("6 passed")
		} catch (error: any) {
			throw new Error(`Rule priority tests failed: ${error.message}`)
		}
	}, 30000)
})
```

**ì£¼ìš” íŠ¹ì§•:**

-   **ì‹¤ì œ ëª…ë ¹ì–´ ì‹¤í–‰**: `npm run build`, `npm run compile` ë“± ì‹¤ì œ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ ê²€ì¦
-   **í¬ë¡œìŠ¤ í”Œë«í¼ í˜¸í™˜**: Windows/Linux/Mac í™˜ê²½ ê³ ë ¤
-   **ë¹Œë“œ ì—ëŸ¬ ê°ì§€**: í…ŒìŠ¤íŠ¸ì—ì„œ ë†“ì¹  ìˆ˜ ìˆëŠ” ì‹¤ì œ ë¹Œë“œ ë¬¸ì œ ì¡°ê¸° ë°œê²¬
-   **ES6 ëª¨ë“ˆ í˜•ì‹ ê²€ì¦**: CommonJS/ES6 ëª¨ë“ˆ í˜¸í™˜ì„± ë¬¸ì œ ê°ì§€
-   **ì¥ì‹œê°„ íƒ€ì„ì•„ì›ƒ**: ì‹¤ì œ ë¹Œë“œ ì‹œê°„ì„ ê³ ë ¤í•œ íƒ€ì„ì•„ì›ƒ ì„¤ì •

#### 4.4.2 ë°±ì—”ë“œ-í”„ë¡ íŠ¸ì—”ë“œ í†µì‹  í…ŒìŠ¤íŠ¸ (ê¸°ì¡´ ë°©ì‹)

```typescript
// src/test/integration/webview-communication.test.ts
import * as vscode from "vscode"
import { CaretProvider } from "../../caret-src/core/webview/CaretProvider"

describe("Webview Communication Integration", () => {
	let provider: CaretProvider
	let mockContext: vscode.ExtensionContext

	beforeEach(() => {
		mockContext = {
			subscriptions: [],
			extensionUri: vscode.Uri.file("/test"),
		} as any
		provider = new CaretProvider(mockContext)
	})

	it("should handle message from webview", async () => {
		const testMessage = { type: "test", data: "hello" }

		// ë©”ì‹œì§€ ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜
		await provider.handleWebviewMessage(testMessage)

		// ì‘ë‹µ ê²€ì¦
		expect(provider.lastResponse).toEqual({
			type: "response",
			data: "received: hello",
		})
	})
})
```

## 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### 5.1 ê°œë°œ ì¤‘ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

#### 5.1.1 ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test:backend

# ì»¤ë²„ë¦¬ì§€ì™€ í•¨ê»˜ ì‹¤í–‰
npm run test:backend:coverage

# íŠ¹ì • íŒŒì¼ í…ŒìŠ¤íŠ¸
npm run test:backend -- CaretProvider.test.ts

# í†µí•© í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
npm run test:backend -- integration

# Watch ëª¨ë“œ
npm run test:backend:watch
```

#### 5.1.2 í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test:frontend

# ì»¤ë²„ë¦¬ì§€ì™€ í•¨ê»˜ ì‹¤í–‰
npm run test:frontend:coverage

# íŠ¹ì • ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
npm run test:frontend -- CaretWelcome.test.tsx

# Watch ëª¨ë“œ
npm run test:frontend:watch
```

### 5.2 ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

#### 5.2.1 ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ (ë°±ì—”ë“œ + í”„ë¡ íŠ¸ì—”ë“œ)
npm test

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ ì „ì²´ í…ŒìŠ¤íŠ¸
npm run test:coverage

# CI/CDìš© í…ŒìŠ¤íŠ¸ (ë³‘ë ¬ ì‹¤í–‰)
npm run test:ci
```

#### 5.2.2 ì»¤ë²„ë¦¬ì§€ ë¶„ì„

```bash
# Caret ì „ìš© ì»¤ë²„ë¦¬ì§€ ë¶„ì„
node caret-scripts/caret-coverage-check.js

# ìƒì„¸ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
npm run coverage:report
```

### 5.1 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´

#### 5.1.1 `npm run test:all` â­ **(ê¶Œì¥) í†µí•© í…ŒìŠ¤íŠ¸ (ë°±ì—”ë“œ + í”„ë¡ íŠ¸ì—”ë“œ)**

-   **ì„¤ëª…**: ê°€ì¥ ì•ˆì •ì ì´ê³  í¬ê´„ì ì¸ ì „ì²´ í…ŒìŠ¤íŠ¸ ë°©ë²•ì…ë‹ˆë‹¤. ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œì˜ ëª¨ë“  Vitest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
-   **ì‹¤í–‰**: `npm run test:all`
-   **ì‚¬ìš© ì‹œì **:
    -   ë¡œì»¬ ê°œë°œ ì¤‘ ìˆ˜ì‹œë¡œ ì‹¤í–‰í•˜ì—¬ ì½”ë“œ ë³€ê²½ ì‚¬í•­ ê²€ì¦
    -   Git ì»¤ë°‹ ë° í‘¸ì‹œ ì „ í•„ìˆ˜ ì‹¤í–‰í•˜ì—¬ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
-   **ëª©í‘œ ìƒíƒœ**: **í•­ìƒ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (All Pass)**. CI/CD íŒŒì´í”„ë¼ì¸ì˜ í•µì‹¬ ê²€ì¦ ë‹¨ê³„ì…ë‹ˆë‹¤.
-   **í˜„ì¬ ìƒíƒœ**: ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ í†µê³¼í•©ë‹ˆë‹¤.

#### 5.1.2 `npm test` âš ï¸ **(ì£¼ì˜) ì „ì²´ í…ŒìŠ¤íŠ¸ (ë‹¨ìœ„ + í†µí•©)**

-   **ì„¤ëª…**: `package.json`ì˜ ë©”ì¸ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¡œ, `pretest` (ë¹Œë“œ, `test:all` í¬í•¨ ê°€ëŠ¥ì„±) í›„ ì¶”ê°€ì ì¸ ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ëŠ” `test:all`ê³¼ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•˜ë‚˜, ê³¼ê±° ESM ì´ìŠˆê°€ ìˆì—ˆìŠµë‹ˆë‹¤.)
-   **ì‹¤í–‰**: `npm test`
-   **ì‚¬ìš© ì‹œì **: í”„ë¡œì íŠ¸ì˜ ê³µì‹ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë‚˜, í˜„ì¬ëŠ” `npm run test:all`ì˜ ì•ˆì •ì„±ì„ ë” ê¶Œì¥í•©ë‹ˆë‹¤.
-   **ì£¼ì˜ì‚¬í•­**: ê³¼ê±° `@google/genai` ESM ê´€ë ¨ ì´ìŠˆë¡œ ì‹¤íŒ¨ ê°€ëŠ¥ì„±ì´ ìˆì—ˆìœ¼ë¯€ë¡œ, `npm run test:all` ì‚¬ìš©ì„ ìš°ì„ ì ìœ¼ë¡œ ê¶Œì¥í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” `npm run test:all`ê³¼ ë™ì¼í•˜ê²Œ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•©ë‹ˆë‹¤.

#### 5.1.3 ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test:backend

# ì»¤ë²„ë¦¬ì§€ì™€ í•¨ê»˜ ì‹¤í–‰
npm run test:backend:coverage

# íŠ¹ì • íŒŒì¼ í…ŒìŠ¤íŠ¸
npm run test:backend -- CaretProvider.test.ts

# í†µí•© í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
npm run test:backend -- integration

# Watch ëª¨ë“œ
npm run test:backend:watch
```

## 6. í†µí•© í…ŒìŠ¤íŠ¸ êµ¬í˜„ ë³€í™” (2025-01-21 ì—…ë°ì´íŠ¸)

### 6.1 ìƒˆë¡œìš´ í†µí•© í…ŒìŠ¤íŠ¸ ë°©ì‹

#### 6.1.1 ë³€ê²½ ë°°ê²½

ê¸°ì¡´ì˜ í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ëª¨í‚¹ëœ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ì—¬ **ì‹¤ì œ ë¹Œë“œ ì—ëŸ¬ë¥¼ ê°ì§€í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ**ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œë“¤ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤:

-   **CommonJS vs ES6 ëª¨ë“ˆ í˜¸í™˜ì„± ë¬¸ì œ**: `grpc-client.js`ê°€ CommonJS í˜•ì‹ì´ì—ˆëŠ”ë° TypeScriptì—ì„œ ES6 import ì‚¬ìš©
-   **ë¹Œë“œ ì„±ê³µ vs í…ŒìŠ¤íŠ¸ í†µê³¼ ë¶ˆì¼ì¹˜**: í…ŒìŠ¤íŠ¸ëŠ” í†µê³¼í•˜ì§€ë§Œ ì‹¤ì œ ë¹Œë“œëŠ” ì‹¤íŒ¨í•˜ëŠ” ìƒí™©
-   **í”„ë¡œí† ì½œ ë²„í¼ ìƒì„± íŒŒì¼ ê²€ì¦ ë¶€ì¡±**: ìë™ ìƒì„± íŒŒì¼ì˜ í˜•ì‹ ê²€ì¦ ëˆ„ë½

#### 6.1.2 ìƒˆë¡œìš´ ì ‘ê·¼ ë°©ì‹

**ì‹¤ì œ ëª…ë ¹ì–´ ì‹¤í–‰ ê¸°ë°˜ í†µí•© í…ŒìŠ¤íŠ¸**ë¡œ ë³€ê²½í•˜ì—¬ ë‹¤ìŒì„ ê²€ì¦í•©ë‹ˆë‹¤:

1. **ì‹¤ì œ ë°±ì—”ë“œ ì»´íŒŒì¼**: `npm run check-types` ì‹¤í–‰ìœ¼ë¡œ TypeScript ì»´íŒŒì¼ ê²€ì¦
2. **ì‹¤ì œ í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ**: `npm run build` ì‹¤í–‰ìœ¼ë¡œ Vite ë¹Œë“œ ê²€ì¦
3. **íŒŒì¼ í˜•ì‹ ê²€ì¦**: ìë™ ìƒì„±ëœ íŒŒì¼ë“¤ì˜ ì‹¤ì œ ë‚´ìš© ê²€ì¦
4. **ê¸°ëŠ¥ë³„ í…ŒìŠ¤íŠ¸ ì—°ë™**: íŠ¹ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²€ì¦

#### 6.1.3 êµ¬í˜„ëœ ê²€ì¦ í•­ëª©

```typescript
// ì‹¤ì œ êµ¬í˜„ëœ í†µí•© í…ŒìŠ¤íŠ¸ í•­ëª©ë“¤
describe("Integration Tests", () => {
	// 1. ë°±ì—”ë“œ TypeScript ì»´íŒŒì¼ ê²€ì¦
	it("should compile backend successfully", async () => {
		const { stdout, stderr } = await execAsync("npm run check-types")
		expect(stderr).toBe("")
		expect(stdout).toContain("tsc --noEmit")
	}, 30000)

	// 2. í”„ë¡ íŠ¸ì—”ë“œ Vite ë¹Œë“œ ê²€ì¦
	it("should build webview-ui successfully", async () => {
		const { stdout, stderr } = await execAsync("cd webview-ui && npm run build")
		expect(stdout).toContain("vite")
		expect(stdout).toContain("building for production")
		expect(stderr).not.toContain("Build failed")
	}, 60000)

	// 3. ìë™ ìƒì„± íŒŒì¼ í˜•ì‹ ê²€ì¦
	it("should have grpc-client files in ES6 module format", async () => {
		const content = fs.readFileSync("webview-ui/src/services/grpc-client.js", "utf8")
		expect(content).toContain("import {")
		expect(content).toContain("export const")
		expect(content).not.toContain("require(")
	})

	// 4. íŠ¹ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê²€ì¦
	it("should have consistent rule priority logic", async () => {
		const { stdout } = await execAsync("npm run test:backend -- rule-priority")
		expect(stdout).toContain("6 passed")
	}, 30000)
})
```

#### 6.1.4 í¬ë¡œìŠ¤ í”Œë«í¼ ê³ ë ¤ì‚¬í•­

Windows í™˜ê²½ì—ì„œ `head` ëª…ë ¹ì–´ê°€ ì—†ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´:

-   **íŒŒì¼ ì‹œìŠ¤í…œ API ì‚¬ìš©**: `fs.readFileSync()` ì§ì ‘ ì‚¬ìš©
-   **PowerShell í˜¸í™˜**: Windows PowerShellì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ëª…ë ¹ì–´ë§Œ ì‚¬ìš©
-   **ê²½ë¡œ ì²˜ë¦¬**: `path.join()`ìœ¼ë¡œ í¬ë¡œìŠ¤ í”Œë«í¼ ê²½ë¡œ ì²˜ë¦¬

### 6.2 í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²• ë° ê²°ê³¼

#### 6.2.1 ê°œë³„ ì‹¤í–‰

```bash
# í†µí•© í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
npx vitest run caret-src/__tests__/integration.test.ts

# íŠ¹ì • í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx vitest run caret-src/__tests__/integration.test.ts -t "should build webview-ui"
```

#### 6.2.2 ì „ì²´ í…ŒìŠ¤íŠ¸ì—ì„œì˜ ì—­í•  ë° ê²°ê³¼

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ í†µí•© í…ŒìŠ¤íŠ¸ë„ í¬í•¨
npm test
# â†’ pretest â†’ compile â†’ test:all
# â†’ í”„ë¡ íŠ¸ì—”ë“œ: 80ê°œ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…
# â†’ ë°±ì—”ë“œ: 30ê°œ í…ŒìŠ¤íŠ¸ í†µê³¼ (í†µí•©í…ŒìŠ¤íŠ¸ 5ê°œ í¬í•¨) âœ…
# â†’ ì´ 110ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼ ğŸ‰
```

#### 6.2.3 CI/CDì—ì„œì˜ í™œìš©

í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì‹¤ì œ ë¹Œë“œ ë¬¸ì œë¥¼ ì¡°ê¸°ì— ê°ì§€í•˜ë¯€ë¡œ:

-   **ë¹Œë“œ íŒŒì´í”„ë¼ì¸ ì‹ ë¢°ì„± í–¥ìƒ**
-   **ë°°í¬ ì „ ì‹¤ì œ ë™ì‘ ê²€ì¦**
-   **ê°œë°œì ë¡œì»¬ í™˜ê²½ê³¼ CI í™˜ê²½ ì¼ì¹˜ì„± í™•ì¸**

## 7. í…ŒìŠ¤íŠ¸ í’ˆì§ˆ ê¸°ì¤€

### 7.1 ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€

#### 7.1.1 Caret ì „ìš© ì½”ë“œ

-   **Statement Coverage**: 100%
-   **Function Coverage**: 100%
-   **Branch Coverage**: 100%
-   **Line Coverage**: 100%

#### 7.1.2 Cline ì›ë³¸ ì½”ë“œ

-   **ì°¸ê³ ìš© ëª¨ë‹ˆí„°ë§**: í˜„ì¬ ìƒíƒœ ìœ ì§€
-   **íšŒê·€ í…ŒìŠ¤íŠ¸**: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### 7.2 í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í’ˆì§ˆ

#### 7.2.1 í•„ìˆ˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

-   **ì •ìƒ ê²½ë¡œ (Happy Path)**: ê¸°ë³¸ ê¸°ëŠ¥ ë™ì‘
-   **ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸**: ìµœì†Œ/ìµœëŒ€ê°’, ë¹ˆ ê°’ ë“±
-   **ì˜ˆì™¸ ì²˜ë¦¬**: ì˜¤ë¥˜ ìƒí™© ëŒ€ì‘
-   **ì—£ì§€ ì¼€ì´ìŠ¤**: íŠ¹ìˆ˜í•œ ìƒí™©ë“¤
-   **í†µí•© ì‹œë‚˜ë¦¬ì˜¤**: ì‹¤ì œ ë¹Œë“œ/ë°°í¬ í”„ë¡œì„¸ìŠ¤ ê²€ì¦ (ì‹ ê·œ ì¶”ê°€)

#### 7.2.2 í…ŒìŠ¤íŠ¸ ì½”ë“œ í’ˆì§ˆ

-   **ê°€ë…ì„±**: ëª…í™•í•œ í…ŒìŠ¤íŠ¸ ì´ë¦„ê³¼ êµ¬ì¡°
-   **ë…ë¦½ì„±**: í…ŒìŠ¤íŠ¸ ê°„ ì˜ì¡´ì„± ì—†ìŒ
-   **ë°˜ë³µì„±**: ë™ì¼í•œ ê²°ê³¼ ë³´ì¥
-   **ì†ë„**: ë¹ ë¥¸ ì‹¤í–‰ ì‹œê°„

## 7. CI/CD í†µí•©

### 7.1 GitHub Actions ì„¤ì •

```yaml
# .github/workflows/test.yml
name: Test Coverage

on: [push, pull_request]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: "18"

            - name: Install dependencies
              run: npm ci

            - name: Run tests with coverage
              run: npm run test:coverage

            - name: Check Caret coverage
              run: node caret-scripts/caret-coverage-check.js

            - name: Upload coverage
              uses: codecov/codecov-action@v3
              with:
                  file: ./coverage/lcov.info
```

### 7.2 Pre-commit í›…

```bash
# .husky/pre-commit
#!/bin/sh
npm run test:quick
npm run lint
```

## 8. ëª¨ë²” ì‚¬ë¡€

### 8.1 í…ŒìŠ¤íŠ¸ ì‘ì„± ëª¨ë²” ì‚¬ë¡€

#### 8.1.1 AAA íŒ¨í„´

```typescript
describe("CaretLogger", () => {
	it("should format log message correctly", () => {
		// Arrange (ì¤€ë¹„)
		const logger = new CaretLogger("test")
		const message = "test message"

		// Act (ì‹¤í–‰)
		const result = logger.formatMessage("INFO", message)

		// Assert (ê²€ì¦)
		expect(result).toBe("[INFO][test] test message")
	})
})
```

#### 8.1.2 ëª…í™•í•œ í…ŒìŠ¤íŠ¸ ì´ë¦„

```typescript
// ì¢‹ì€ ì˜ˆ
it("should return error when API key is missing", () => {})
it("should render loading spinner while fetching data", () => {})

// ë‚˜ìœ ì˜ˆ
it("should work", () => {})
it("test API", () => {})
```

### 8.2 Mock ì‚¬ìš© ê°€ì´ë“œ

#### 8.2.1 ì™¸ë¶€ ì˜ì¡´ì„± ëª¨í‚¹

```typescript
// API í˜¸ì¶œ ëª¨í‚¹
jest.mock("../api/client", () => ({
	fetchData: jest.fn().mockResolvedValue({ data: "test" }),
}))

// VSCode API ëª¨í‚¹
jest.mock("vscode", () => ({
	window: {
		showInformationMessage: jest.fn(),
	},
}))
```

#### 8.2.2 ì‹œê°„ ê´€ë ¨ í…ŒìŠ¤íŠ¸

```typescript
describe("timestamp functionality", () => {
	beforeEach(() => {
		jest.useFakeTimers()
		jest.setSystemTime(new Date("2024-01-01"))
	})

	afterEach(() => {
		jest.useRealTimers()
	})

	it("should generate correct timestamp", () => {
		const timestamp = generateTimestamp()
		expect(timestamp).toBe("2024-01-01T00:00:00.000Z")
	})
})
```

## 9. ë¬¸ì œ í•´ê²°

### 9.1 ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 9.1.1 VSCode API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜

```typescript
// í•´ê²°ì±…: ì ì ˆí•œ ëª¨í‚¹ ì„¤ì •
jest.mock("vscode", () => ({
	// í•„ìš”í•œ APIë§Œ ëª¨í‚¹
}))
```

#### 9.1.2 ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜

```typescript
// í•´ê²°ì±…: async/await ì‚¬ìš©
it("should handle async operation", async () => {
	const result = await asyncFunction()
	expect(result).toBeDefined()
})
```

### 9.2 ì„±ëŠ¥ ìµœì í™”

#### 9.2.1 í…ŒìŠ¤íŠ¸ ì†ë„ ê°œì„ 

-   ë¶ˆí•„ìš”í•œ ëª¨í‚¹ ì œê±°
-   í…ŒìŠ¤íŠ¸ ë°ì´í„° ìµœì†Œí™”
-   ë³‘ë ¬ ì‹¤í–‰ í™œìš©

#### 9.2.2 ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”

-   í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ ì‘ì—…
-   ëŒ€ìš©ëŸ‰ ë°ì´í„° ì‚¬ìš© ì‹œ ì£¼ì˜

## 10. ì°¸ê³  ìë£Œ

### 10.1 ê´€ë ¨ ë¬¸ì„œ

-   [í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± í‘œì¤€](./test-writing-standards.mdx)
-   [ë¬¸ì„œí™” ê°€ì´ë“œ](./documentation-guide.mdx)
-   [AI ì‘ì—… ë°©ë²•ë¡  ê°€ì´ë“œ](../guides/ai-work-method-guide.mdx)

### 10.2 ë„êµ¬ ë¬¸ì„œ

-   [Jest ê³µì‹ ë¬¸ì„œ](https://jestjs.io/)
-   [Vitest ê³µì‹ ë¬¸ì„œ](https://vitest.dev/)
-   [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025ë…„ 1ì›” 21ì¼ - í†µí•©í…ŒìŠ¤íŠ¸ êµ¬í˜„ ë³€í™” ë° Vitest í†µì¼ ì™„ë£Œ
**ì‘ì„±**: Alpha (AI ì–´ì‹œìŠ¤í„´íŠ¸)
**ê²€í† **: Luke (ê°œë°œì)
