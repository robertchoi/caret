# Task #002-3: 통합 테스트 구축

**작업 기간**: 1일 (2-4시간)  
**담당자**: luke  
**우선순위**: **High**  
**예상 시간**: 4시간  
**의존성**: Task #002-1, #002-2 완료 후 진행

## 🎯 작업 개요

### 목표
- Extension Host 환경에서 실제 저장/로드 플로우를 검증하는 통합 테스트 시스템을 구축한다

### 배경
- 현재 모킹된 환경에서는 저장소 불일치 같은 실제 문제를 검증할 수 없음
- Extension Host 실제 실행 환경과 테스트 환경의 차이로 인한 검증 한계
- 설정 시스템의 전체 플로우 검증 필요

### 범위
- ✅ **포함**: Extension Host 환경 통합 테스트, 실제 저장/로드 검증, 회귀 테스트
- ❌ **제외**: 단위 테스트 개선, 새로운 기능 테스트

### 주요 산출물
- Extension Host 환경 통합 테스트 스위트
- 실제 저장/로드 플로우 검증 테스트
- 저장소 불일치 방지 테스트

## 📚 작업 전 숙지사항 (AI 필수)
- `caret-docs/tasks/002-language-settings-restoration.md`: 마스터 작업 전체 맥락
- `caret-docs/development/testing-guide.mdx`: 통합 테스트 요구사항 및 방법론
- `caret-src/__tests__/integration.test.ts`: 기존 통합 테스트 구조
- VSCode Extension 테스트 환경 설정 방법

## ✅ 실행 체크리스트

### Phase 1: 테스트 환경 설정
- [ ] **1.1 Extension Host 테스트 환경 분석**: 현재 통합 테스트 구조 파악
- [ ] **1.2 테스트 시나리오 설계**: 저장/로드 플로우 검증 시나리오 작성
- [ ] **1.3 테스트 데이터 준비**: 다양한 설정값 테스트 케이스 준비

### Phase 2: TDD 기반 테스트 구현
- [ ] **2.1 실패 테스트 작성**: 저장소 불일치 검증 테스트 (RED)
- [ ] **2.2 통합 테스트 구현**: 실제 Extension Host 환경 테스트 (GREEN)
- [ ] **2.3 테스트 최적화**: 테스트 실행 시간 및 안정성 개선 (REFACTOR)

### Phase 3: 검증 및 문서화
- [ ] **3.1 전체 플로우 테스트**: 설정 저장 → 재시작 → 로드 검증
- [ ] **3.2 에지 케이스 테스트**: 빈 값, 잘못된 값, 마이그레이션 시나리오
- [ ] **3.3 테스트 문서화**: 테스트 실행 방법 및 시나리오 문서화

## 🔧 기술적 제약사항
- Extension Host 환경에서 실행되는 실제 통합 테스트 구현
- 테스트 격리: 각 테스트가 서로 영향을 주지 않도록 설정
- CI/CD 환경에서도 실행 가능한 테스트 구조

## 📝 진행 노트 (실시간 업데이트)
### 테스트 시나리오
1. **저장소 일관성 테스트**: globalState/workspaceState 일관성 검증
2. **설정 영속성 테스트**: 확장 재시작 후 설정 보존 확인
3. **마이그레이션 테스트**: 기존 설정 데이터 호환성 확인

### 구현 방향
- [ ] Extension Host 환경 활용한 실제 테스트
- [ ] 모킹 최소화, 실제 저장소 사용
- [ ] 테스트 격리 및 정리 로직 구현

## ✅ 완료 기준
- [ ] 모든 체크리스트 항목 완료
- [ ] Extension Host 환경에서 통합 테스트 성공
- [ ] 저장/로드 플로우 전체 검증 완료
- [ ] 회귀 테스트로 기존 기능 보호 확인
- [ ] 테스트 실행 가이드 문서 작성 완료 