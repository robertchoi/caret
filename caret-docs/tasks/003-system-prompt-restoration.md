# Task #005: Cline 프롬프트 시스템 JSON 템플릿화

**프로젝트**: Caret  
**담당자**: luke  
**우선순위**: 🚨 **Critical - 핵심 기능 개선**  
**전체 기간**: 2-3주 (점진적 구현)  
**상태**: 🔄 **작업 중**

## 🚨 **현재 상황 분석**

### **발견된 Cline 프롬프트 시스템 전체 규모**

**Cline의 하드코딩된 프롬프트 파일들**:

| 파일 | 줄 수 | 사용량 | 중요도 | 내용 |
|------|-------|--------|--------|------|
| **system.ts** | 727줄 | 핵심 1회 | 🔥 **최고** | 기본 시스템 프롬프트 |
| **responses.ts** | 301줄 | **44회** | 🔥 **매우높음** | 응답 템플릿 시스템 |
| **claude4.ts** | 715줄 | 조건부 | 🔶 **중간** | Claude4 전용 프롬프트 |
| **claude4-experimental.ts** | 347줄 | 실험적 | 🔶 **낮음** | 실험적 기능용 |
| **loadMcpDocumentation.ts** | 362줄 | MCP만 | 🔶 **낮음** | MCP 서버 가이드 |
| **commands.ts** | 179줄 | 특정 기능 | 🔶 **낮음** | 명령어 응답들 |

**총 2,631줄의 하드코딩!**

### **현재 구현 상태**

✅ **이미 완료된 기반 시스템**:
- CaretSystemPrompt 클래스 구현 완료
- JsonTemplateLoader 구현 완료  
- PromptOverlayEngine 구현 완료
- caret-src/core/prompts/system.ts 래퍼 구현 완료
- Chatbot/Agent 모드 기본 지원 구현 완료

✅ **system.ts 일부 작업 완료**:
- src/core/prompts/system.ts에 CARET MODIFICATION 적용
- 기본적인 JSON 오버레이 연결 구현

❌ **미완성 부분**:
- system.ts 완전한 JSON 변환 (727줄 → JSON 섹션)
- responses.ts 등 나머지 5개 파일 미처리
- Plan/Act → Chatbot/Agent UI 변경 미완성

## 🎯 **목표: Cline/Caret 선택 가능한 하이브리드 시스템**

### **핵심 목표**
1. **성능 비교 지원**: Cline(하드코딩) vs Caret(JSON) 선택 옵션 제공
2. **실시간 전환**: 코드 수정 없이 설정으로 시스템 변경 가능
3. **기능 100% 보존**: 모든 Cline 기능 완전 유지 (양쪽 모드)
4. **Plan/Act → Chatbot/Agent**: 더 효율적인 협업 모드로 개선
5. **성능 메트릭**: 각 시스템의 응답속도, 품질 측정 기능

### **Chatbot/Agent 모드 개선점**

#### **🤖 Agent 모드 (기본값)**
- **협력적 지능**: 분석과 실행을 자연스럽게 결합
- **전체적 사고**: 아키텍처 관점에서 문제 접근
- **균형잡힌 접근**: 충분한 분석 후 적절한 행동

#### **💬 Ask 모드**
- **질의응답 전용**: 코드 실행 없이 전문적 조언
- **분석 중심**: SW 개발 전문가 관점의 상담
- **사용자 주도**: 직접 코딩을 원하는 사용자 지원

## 📋 **점진적 구현 계획**

### **Phase 1: Chatbot/Agent 시스템 완성 (현재 기반 활용)**

| Task | 제목 | 목표 |
|------|------|------|
| **003-01** | ~~기반 시스템 구축~~ | ~~CaretSystemPrompt 클래스 구현~~ |
| **003-02** | ~~JSON 오버레이 시스템~~ | ~~JsonTemplateLoader, PromptOverlayEngine~~ 
| **003-03** | JSON 오버레이 시스템 점검 | 현재 구현 상태 점검 및 보완 |
| **003-04** | Cline/Caret 선택 시스템 구현 | 설정 기반 Cline(하드코딩) ↔ Caret(JSON) 전환 |
| **003-05** | Plan/Act → Chatbot/Agent 백엔드 대체 | Plan/Act 로직을 Chatbot/Agent로 대체 및 보강 |
| **003-06** | UI Chatbot/Agent 변경 + 통합 테스트 | 프론트엔드 변경 및 즉시 통합 검증 | 

### **Phase 2: responses.ts 확장 (2단계 접근)**

| Task | 제목 | 목표 | 상태 |
|------|------|------|------|
| **003-07** | responses.ts 검증 도구 개발 | 44개 formatResponse 분석 및 안전성 검증 | |
| **003-08** | responses.ts JSON 교체 작업 | formatResponse → JSON 템플릿 변환 |  |

### **Phase 3: 나머지 파일들 확장 (2단계 접근)**

| Task | 제목 | 목표 | 상태 |
|------|------|------|------|
| **003-09** | 나머지 파일들 검증 도구 | claude4.ts 등 4개 파일 분석 도구 |  |
| **003-10** | 나머지 파일들 JSON 교체 | 우선순위별 단계적 JSON 변환 |  |

### **Phase 4: 최종 통합**

| Task | 제목 | 목표 | 상태 |
|------|------|------|------|
| **003-11** | 통합 테스트 및 검증 | 전체 시스템 안정성 검증 |  |
| **003-12** | UI 완성 및 문서화 | 사용자 경험 완성, 문서 업데이트 | |

## 🔧 **핵심 구현 원칙**

### **1. 안전성 우선**
- **2단계 접근**: 검증 도구 → 교체 작업
- **기능 보존**: 모든 Cline 기능 100% 유지
- **롤백 용이성**: 문제 발생시 즉시 복구 가능

### **2. 점진적 확장**
- **핵심부터**: system.ts (핵심) → responses.ts (고사용) → 나머지
- **검증 후 진행**: 각 단계 완료 후 다음 단계 진행
- **피드백 반영**: 각 단계에서 학습한 내용 다음 단계 적용

### **3. Cline 원본 보존**
- **백업 의무**: 모든 Cline 원본 파일 .cline 백업
- **최소 수정**: CARET MODIFICATION으로 필요한 부분만 수정
- **호환성 유지**: 향후 Cline 업데이트 대응 가능

## 🚀 **다음 단계: 현재 상황 정확한 파악 필요**

**현재 어디까지 완료됐는지 확인 후 적절한 지점부터 시작**
- 003-03, 003-04 완료 상태 검토 필요
- 실제 구현 상태에 맞는 시작점 결정
- Chatbot/Agent 모드 구현 진행도 파악

**정확한 현재 상태 파악 후 최적의 시작점에서 진행!**
