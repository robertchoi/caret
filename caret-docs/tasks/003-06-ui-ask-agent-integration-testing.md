# Task #003-06: Caret-Cline 하이브리드 모드 통합 (현재 문제 상황)

**프로젝트**: Caret  
**담당자**: luke  
**우선순위**: 🚨 **Critical - 시스템 혼란 상태 정리 필요**  
**예상 시간**: 4-6시간  
**상태**: ⚠️ **문제 발생 - 체크아웃 후 정리 필요** 
**일시**: 2025-01-28

## 🚨 **현재 문제 상황 (2025-01-28)**

### **핵심 문제점**
1. **모드 전환 혼란**: Caret/Cline 모드 전환 시 각각 올바른 모드로 동작하지 않음
2. **채팅 기록 변조**: 과거 대화 내용이 현재 설정에 따라 동적으로 변경됨 (매우 심각)
3. **용어 혼재**: ASK 용어가 여전히 일부 남아있음
4. **시스템 프롬프트 오염**: Cline 원본 시스템 프롬프트를 건드려서 복잡해짐
5. **설정 기본값 문제**: 모드 전환 시 올바른 기본값으로 설정되지 않음

### **예상 동작 vs 실제 동작**

#### **예상 동작**
```
Caret 모드:
- 기본값: Agent 모드
- 버튼: [Chatbot] [Agent]
- 동작: Caret 고유 기능

Cline 모드:  
- 기본값: Plan 모드
- 버튼: [Plan] [Act]
- 동작: Cline 원본 기능
```

#### **실제 문제**
```
❌ 모드가 마구 헷갈림
❌ 채팅 창의 과거 대화 내용이 현재 설정에 따라 변경됨
❌ 설정과 버튼이 정확히 연동되지 않음
❌ ASK 용어가 여전히 섞여있음
❌ 시스템 프롬프트가 복잡해짐
```

### **체크아웃 후 상황**
- 이전 상태로 되돌렸지만 여전히 문제가 남아있는 상태
- 여러 시간 작업했지만 오히려 더 복잡해진 상황

## 🔍 **문제 분석**

### **1. 채팅 기록 변조 문제 (가장 심각)**
```typescript
// 문제: 과거 대화의 "ASK MODE"/"AGENT MODE" 표시가 
// 현재 UI 설정에 따라 "PLAN MODE"/"AGENT MODE"로 바뀜
// 이는 대화 무결성을 해치는 심각한 문제
```

### **2. 모드 시스템 혼란**
```typescript
// 현재 상태: 여러 레이어에서 서로 다른 용어 사용
- UI 레이어: Chatbot/Agent (일부 ASK 혼재)
- 시스템 레이어: ask/agent  
- 표시 레이어: PLAN/ACT vs CHATBOT/AGENT
- Cline 원본: ask/agent
```

### **3. 시스템 프롬프트 오염**
- Cline 원본 시스템 프롬프트를 수정해서 복잡해짐
- 원본 보존 원칙 위반
- 백업이 있어도 복원 시 호환성 문제 가능

## 📋 **정리 계획 (다음 세션)**

### **Phase 1: 문제 상황 정확한 파악**
1. **현재 git 상태 확인**
   - 어떤 파일들이 변경되었는지 확인
   - 백업 파일들 상태 점검
   - 복원 가능한 상태인지 검증

2. **핵심 문제 우선순위 설정**
   - 채팅 기록 변조 문제 (최우선)
   - 모드 전환 로직 혼란
   - 용어 통일 미완성
   - 시스템 프롬프트 복잡성

### **Phase 2: 단계적 복원 및 정리**
1. **Cline 원본 완전 복원**
   ```bash
   # 모든 .cline 백업에서 원본 복원
   # 시스템 프롬프트 원본 상태로 되돌리기
   ```

2. **단순한 접근법 재설계**
   - Cline 원본 시스템 프롬프트 절대 건드리지 않기
   - UI 레이어에서만 용어 변환 처리
   - 채팅 기록 무결성 보장

3. **모드 시스템 단순화**
   ```typescript
   // 목표: 단순하고 명확한 구조
   interface ModeSystem {
     // UI에서만 표시 용어 변경
     // 내부 로직은 Cline 원본 그대로 유지
   }
   ```

### **Phase 3: 검증 및 테스트**
1. **채팅 기록 무결성 확인**
2. **모드 전환 정확성 검증**  
3. **용어 통일성 점검**
4. **Cline 호환성 확인**

## ⚠️ **다음 세션 주의사항**

### **절대 금지사항**
- ❌ Cline 원본 시스템 프롬프트 수정 금지
- ❌ 채팅 기록에 영향을 주는 동적 변환 금지
- ❌ 복잡한 다층 변환 로직 금지

### **원칙**
- ✅ 단순함 우선 (KISS 원칙)
- ✅ Cline 원본 보존 우선
- ✅ 채팅 기록 무결성 우선
- ✅ 사용자 경험 일관성 우선

### **접근 방법**
1. **최소 침습적 수정**: UI 표시만 변경, 내부 로직 보존
2. **명확한 분리**: Caret 기능 vs Cline 기능 명확히 구분
3. **단계적 검증**: 각 단계마다 동작 확인

## 🎯 **목표 재정의**

### **단기 목표 (다음 세션)**
1. **현재 상황 정확한 파악 및 문제점 정리**
2. **Cline 원본 상태 완전 복원**
3. **단순한 UI 레이어 용어 변환 방식 설계**

### **중기 목표**
1. **채팅 기록 무결성 보장하는 모드 시스템**
2. **Cline 원본을 건드리지 않는 Caret 확장**
3. **명확하고 단순한 사용자 인터페이스**

---
**현재 상태**: ⚠️ **문제 상황 - 체크아웃 후 정리 필요**  
**다음 우선순위**: 🔍 **문제 파악 → 원본 복원 → 단순한 재설계** 